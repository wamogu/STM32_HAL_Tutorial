#CubeMX简介

##简介

在Cube工具还没出来之前，在ST的MCU开发都是用标准固件库，标准库自推出以来受到ST的使用者的推崇，现在很多公司也都在使用。但是ST官方在2013年后就没有更新版本，ST官方也全力推**HAL**（Hardware Abstraction Layer）库。它的存在是为了确保 STM32 系列最大的移植性。HAL 位于操作系统内核与硬件电路之间的接口层，其目的在于将硬件抽象化。CubeMX软件可以直接根据开发人员所需的功能勾选，以HAL库文件基础自动产生代码。开发者就可以轻松应用每一个外设。因此，使用 HAL 库可以大大减少用户的程序编写时间，进而降低开发成本。每个外设驱动都由一组函数组成，这组函数覆盖了该外设所有功能。每个器件的开发都由一个通用 API (application programming interface 应用编程界面)驱动，API 对该驱动程序的结构，函数和参数名称都进行了标准化。

在 ST 官方的声明中，HAL 库是大势所趋，在 ST 公司最新开发的部分芯片中，只有 HAL 库而没有标准库，从这点便可以说明，以后的战略目标是逐渐的转向HAL 库 。相对于标准库来说，在使用 CubeMX 生成代码后，工程项目和初始化代码已经完成。CubeMX也可以用于生成多个编译器的初始化工程配置，诸如MDK和IAR都有着支持，我们**主要使用Makefile工具链路径和MDK**。

不过HAL也存在这代码效率低于标准库，旧芯片型号的资料没有标准库那么多等缺点。对于效率低优化差这个问题，在熟练之后可以用CubeMX生成LL库的代码，或者在关键位置直接操作寄存器以提高代码的运行效率。而资料不足也可以参考库函数的代码进行移植。综合看下，使用HAL库配合CubeMX开发的周期更短，因此我们的教程都会以CubeMX生成的工程为模板工程。

##下载安装

CubeMX为ST公司为开发者提供的免费软件，我们可以直接从[官网下载](https://www.st.com/zh/development-tools/stm32cubemx.html#overview&secondary=st-get-software)到最新的版本。不过下载之前最好问一下周围的使用的是哪一个版本，低版本的CubeMX是打不开高版本配置工程的，这点需要注意。再者，安装时尽量选择一个较大的硬盘以及**全英文的路径**，以避免后面支持包放不下和运行不稳定。

##支持包

安装好软件在生成代码初始化工程之前，我们还需要安装所使用的MCU对应的支持包，打开CubeMX的help一栏，找到如下选项安装芯片支持包：

![安装支持包](assets\安装支持包.png)

以我们入门使用的F4单片机为例，可以安装如下支持包：

![安装F4支持包](assets\安装F4支持包.png)

安装后之后就可开始代码工程的创建了，有要用到的芯片则安装对应系列的支持包即可。不过CubeMX在安装好新版本的支持包后，**不会删除旧的支持包**，硬盘空间紧张的时候可以手动进行删除：

![删除支持包](assets\删除支持包.png)

